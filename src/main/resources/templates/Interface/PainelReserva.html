<!DOCTYPE html>
<html xmlns:th="http://thymeleafe.org">

<head>
<meta charset="utf-8" />
<link rel="apple-touch-icon" sizes="76x76"
	href="../assets/img/apple-icon.png">
<link rel="icon" type="image/png" href="../assets/img/favicon.ico">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>PAINEL USUÀRIO</title>
<meta
	content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
	name='viewport' />
<!--     Fonts and icons     -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">
<link href='/main.css' rel='stylesheet' />
<script src='/main.js'></script>
<script src="/reserva.js"></script>
<!--  <script src="/post.js"></script>-->
<script src="/put.js"></script>
<script src="/delete.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">

<!-- CSS Files -->
<link href="/bootstrapPainel.min.css" rel="stylesheet" />
<link href="/painelAdm.css " rel="stylesheet" />
<script src="/administrador.js"></script>
<script src="/reserva.js"></script>
<!-- CSS Just for demo purpose, don't include it in your project -->
<link href="/demoPainel.css" rel="stylesheet" />
<script
	src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
	integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
	crossorigin="anonymous"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
	crossorigin="anonymous"></script>
<link rel="icon" href="/senaiLogo.png">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
	integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn"
	crossorigin="anonymous">

<style type="text/css">
#calendar {
	max-width: 1100px;
	margin: 30px auto;
}

.fc-bgevent {
	background-color: yellow
}

.fc-daygrid-more-link {
	color: black;
}

.fc-daygrid-more-link:hover {
	color: black;
}

.fc-daygrid-event {
	background-color: #2b2d42;
}

.fc-daygrid-event:hover {
	background-color: #8e9aaf;
	color: black;
}

.fc-daygrid-day-number {
	font-family: cursive;
	color: #000000;
}

.fc-daygrid-event-dot {
	color: white;
}

.fc-event-time {
	color: white;
}

.fc-event-title {
	font-family: monospace;
	color: white;
}

#modalId.modal {
	background: transparent;
	overflow: hidden;
	overflow-y: scroll;
	padding-right: 0 !important;
}

.fc button {
	text-transform: uppercase;
	border-radius: 2px;
	font-size: 13px;
	font-weight: 600;
	transition: box-shadow linear 0.4s;
	background-color: #2196F3;
	border-color: #2196F3;
	margin-top: 10px;
	cursor: pointer;
}
</style>

</head>

<body>
	<div class="wrapper">
		<div class="sidebar" data-image="../assets/img/senai.png">
			<!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

        Tip 2: you can also add an image using data-image tag
    -->
			<div class="sidebar-wrapper">
				<div class="logo">
					<img alt="" style="position: relative; left: 2.8em;" width="120"
						src="/logo_senai_original.png">"
				</div>
				<ul class="nav">

					<li><a id="usuario" class="nav-link" href="#"> <i
							class=" large material-icons">accessibility</i>
					</a></li>


					<li><a class="nav-link" href="/listarHistorico/1"> <i
							class=" large material-icons">home</i>
							<p>Home</p>
					</a></li>

					<li><a class="nav-link" href="/apiInsta"><i
							class="large material-icons">collections</i>
							<p>Hashtag</p> </a></li>



					<li class="nav-item active"><a class="nav-link"
						href="/painelReserva"><i class=" large material-icons">event_seat</i>
							<p>Auditório</p> </a></li>



					<li><a class="nav-link" href="/"> <i
							class=" large material-icons">exit_to_app</i>
							<p>Sair</p>
					</a></li>

					<li id="escondeLista" class="nav-item "><a class="nav-link"
						href="/listarUsuario/1"> <i class=" large material-icons">account_circle</i>
							<p>Usuários</p>
					</a></li>


					<li>
				</ul>
			</div>
		</div>
		<div class="main-panel">
			<!-- Navbar -->



			<div id="calendar"></div>


		</div>


		<!-- Modal -->
		<div class="modal fade" id="modalId" tabindex="-1" role="dialog"
			aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<p class="modal-title" id="exampleModalLongTitle">NOVO EVENTO</p>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form action="/salvarUsuario">
							<input type="hidden" id="idUsuario">
							<div class="form-group">
								<label for="exampleInputEmail1">Título:</label> <input
									placeholder="Insira o titulo" required type="text"
									class="form-control" id="title2">

							</div>
							<div class="form-group">
								<label for="exampleInputEmail1">Inicio:</label> <input required
									id="start2" type="datetime-local" class="form-control"
									aria-describedby="text">
							</div>
							<div class="form-group">
								<label for="exampleInputEmail1">Fim:</label><input required
									id="end2" type="datetime-local" class="form-control"
									aria-describedby="text">
							</div>





							<div class="modal-footer">
								<button type="reset" class="btn btn-dark" data-dismiss="modal">FECHAR</button>
								<button type="button" onclick="historico()"
									class="btn btn-success">SALVAR</button>
							</div>
						</form>
					</div>

				</div>
			</div>
		</div>



		<!-- Modal alterar -->
		<div style="background-color: transparent;" class="modal fade"
			id="modalUpdate" tabindex="-1" role="dialog"
			aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<p class="modal-title" id="exampleModalLongTitle">Ver Evento</p>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form>
							<input type="hidden" id="idUsuario"> <input type="hidden"
								id="idUpdate">

							<div class="form-group">
								<label for="exampleInputEmail1">Título:</label> <input
									placeholder="Insira o titulo" required type="text"
									class="form-control" id="titleUpdate">

							</div>
							<div class="form-group">
								<label for="exampleInputEmail1">Inicio:</label> <input required
									id="startUpdate" type="datetime-local" class="form-control">
							</div>
							<div class="form-group">
								<label for="exampleInputEmail1">Fim:</label><input required
									id="endUpdate" type="datetime-local" class="form-control">
							</div>
							<div class="form-group">
								<label for="exampleInputEmail1">Usuário:</label><input required
									disabled="disabled" id="usuarioUpdate" type="text"
									class="form-control">
							</div>





							<div class="modal-footer">
								<button id="btnExcluir" type="button" onclick="apagar()"
									class="btn btn-dark" data-dismiss="modal">Excluir</button>
								<button id="btnAlterar" type="button" onclick="update()"
									class="btn btn-success">Alterar</button>

							</div>
						</form>
					</div>

				</div>
			</div>
		</div>

		<div id="modalErro" class="modal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Modal title</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<p>Modal body text goes here.</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary">Save
							changes</button>
						<button type="button" class="btn btn-secondary"
							data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>




		<script type="text/javascript">
			function colocaValor() {
				let token = sessionStorage.getItem("token");
				let payload = parseJwt(token);
				var id = payload.id_usuario;
				if (payload.tipo === "usuario") {
					console.log(payload.tipo)
					console.log("ENTREI NO IF DO USUARIO")
					token = sessionStorage.getItem("token");
					payload = parseJwt(token);
					console.log(payload);
					var id = payload.id_usuario;
					var nome = payload.nome_usuario;
					console.log(id);
					let usuario = document.getElementById("usuario")
					let idUsuario = document.getElementById("idUsuario")
					let idUsuarioU = document.getElementById("idUsuarioU")
					let usuarioLink = document.getElementById("usuarioLink")
					console.log(idUsuarioU)
					console.log(usuario)
					console.log(nome)
					console.log(idUsuario)
					idUsuario.value = id;
					usuario.innerHTML = "OLÀ  " + nome;
					//document.querySelectorAll('#idUsuario').value = id;
				} else if (payload.tipo === "administrador") {

					console.log("ENTREI NO ELSE DO ADM")
					let token = sessionStorage.getItem("token");
					let payload = parseJwt(token);
					var nome = payload.nome_usuario;
					console.log(payload);
					var id = payload.id_usuario;
					console.log(id);
					console.log(nome)
					let usuario = document.getElementById("usuario")
					let idUsuario = document.getElementById("idUsuario")
					let idUsuarioU = document.getElementById("idUsuarioU")
					console.log(idUsuarioU)
					console.log(idUsuario)
					idUsuario.value = id;
					usuario.innerHTML = "OLÀ " + nome;

					//document.querySelectorAll('#idUsuario').value = id;

				}
			};

			function parseJwt(token) {
				var base64Url = token.split('.')[1];
				var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
				var jsonPayload = decodeURIComponent(atob(base64).split('')
						.map(
								function(c) {
									return '%'
											+ ('00' + c.charCodeAt(0).toString(
													16)).slice(-2);
								}).join(''));

				return JSON.parse(jsonPayload);
			};
			colocaValor()
		</script>



		<script type="text/javascript">
			function fazPost(url, body) {
				console.log('PASSOU AQUIIIIIIIIIIIIIIII')
				console.log("body=", body)
				let request = new XMLHttpRequest()
				request.onreadystatechange = function() {
					console.log('dentro do retorno' + this.status)
					console.log('dentro do retorno' + this.readyState)
					if (this.readyState == 4 && this.status == 201) {
						console.log("PASSOU AAAAAAA");

						alert("AAAA")

					} else if (this.readyState == 4 && this.status == 409) {
						//  console.log(this)

						alert("ERRO, DATA/HORA EXISTENTE")
					}
				};
				request.open("POST", url, true)
				request.setRequestHeader("content-type", "application/json")
				request.send(JSON.stringify(body))

				return request.responseText
			}
			function historico() {

				let token = sessionStorage.getItem("token");
				let payload = parseJwt(token);
				let url = "http://10.92.198.11:8080/api/evento/"
				let idUsuario = document.getElementById("idUsuario").value
				console.log(idUsuario)
				let id = document.getElementById("idUsuario").value
				let title = document.getElementById("title2").value
				let start = document.getElementById("start2").value
				let end = document.getElementById("end2").value

				let data = new Date()

				var dia = data.getDate();
				var mes = data.getMonth();
				var ano = data.getFullYear();
				var hora = data.getHours();
				var min = data.getMinutes();

				var dataAtual = ano + '-' + '0' + (mes + 1) + '-' + '0' + dia
						+ 'T' + hora + ':' + min;

				if (end < start) {

					alert('A Data final não pode acabar antes da data de inicio!')

					end.focus()

				} else if (start === end) {

					alert("A data de inicio não pode ser igual a data final!")

					end.focus()

				} else if (start < dataAtual) {

					const mensagemErro3 = document.createElement('h5')

					alert('A data/hora inicial não pode ser menor que o dia/hora atual !')

					end.focus()

				} else {

					console.log(id)
					console.log(title)
					console.log(start.toLocaleString())
					console.log(end.toLocaleString())

					body = {
						"id" : "",
						"title" : title,
						"start" : start,
						"end" : end,
						"fotos" : "",
						"usuario" : {
							"id" : idUsuario,
						}
					}
					console.log(body)
					console.log(id)

				}
				fazPost(url, body)
				location.reload();
			};

			function parseJwt(token) {
				var base64Url = token.split('.')[1];
				var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
				var jsonPayload = decodeURIComponent(atob(base64).split('')
						.map(
								function(c) {
									return '%'
											+ ('00' + c.charCodeAt(0).toString(
													16)).slice(-2);
								}).join(''));

				return JSON.parse(jsonPayload);
			};
		</script>

		<script type="text/javascript">
			function fazPut(url, body) {
				console.log("body=", body)
				let request = new XMLHttpRequest()
				request.open("PUT", url, true)
				request.setRequestHeader("content-type", "application/json")
				request.send(JSON.stringify(body))

				request.onreadystatechange = function() {
					console.log('dentro do retorno' + this.status)
					console.log('dentro do retorno' + this.readyState)
					if (this.readyState == 4 && this.status == 201) {
						console.log('PASSOU AQUIIIIIIIIIIIIIIII')

					} else if (this.readyState == 4 && this.status == 409) {
						console.log(this)
						alert("DATA JÀ CADASTRADA")

					}
				}

				return request.responseText
			}
			function update() {
				let token = sessionStorage.getItem("token");
				let payload = parseJwt(token);
				console.log("entrei update")
				let id = document.getElementById("idUpdate").value
				console.log(id)
				let idUsuario = document.getElementById("idUsuario").value
				console.log(idUsuario)
				let title = document.getElementById("titleUpdate").value
				let start = document.getElementById("startUpdate").value
				let end = document.getElementById("endUpdate").value
				let url = "http://10.92.198.11:8080/api/evento/" + id
				let fotos = ""

				let data = new Date()

				var dia = data.getDate();
				var mes = data.getMonth();
				var ano = data.getFullYear();
				var hora = data.getHours();
				var min = data.getMinutes();

				var dataAtual = ano + '-' + '0' + (mes + 1) + '-' + '0' + dia
						+ 'T' + hora + ':' + min;

				if (end < start) {

					alert('A Data final não pode acabar antes da data de inicio!')

					end.focus()

				} else if (start === end) {

					alert("A data de inicio não pode ser igual a data final!")

					end.focus()

				} else if (start < dataAtual) {

					alert('A data/hora inicial não pode ser menor que o dia/hora atual !')

					end.focus()
				} else {

					console.log(id)
					console.log(title)
					console.log(start.toLocaleString())
					console.log(end.toLocaleString())

					body = {
						"id" : id,
						"title" : title,
						"start" : start,
						"end" : end,
						"fotos" : fotos,
						"usuario" : {
							"id" : idUsuario,
						}
					}
					console.log(body)

				}

				fazPut(url, body)
				location.reload()
			}

			function parseJwt(token) {
				var base64Url = token.split('.')[1];
				var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
				var jsonPayload = decodeURIComponent(atob(base64).split('')
						.map(
								function(c) {
									return '%'
											+ ('00' + c.charCodeAt(0).toString(
													16)).slice(-2);
								}).join(''));

				return JSON.parse(jsonPayload);
			};
		</script>
		<script type="text/javascript">
			function esconder() {

				let token = sessionStorage.getItem("token");
				let payload = parseJwt(token);

				if (payload.tipo === "usuario") {

					let escondeLista = document.getElementById("escondeLista");
					escondeLista.style.visibility = "hidden";
				}

			}
			esconder()
		</script>
</html>
